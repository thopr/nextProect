{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\xampp\\\\htdocs\\\\next\\\\contexts\\\\auth.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { createContext, useState, useContext, useEffect } from \"react\";\nimport Cookies from \"js-cookie\";\nimport Router, { useRouter } from \"next/router\"; //api here is an axios instance\n\nimport api from \"../services/Api\";\nvar AuthContext = /*#__PURE__*/createContext({});\nexport var AuthProvider = function AuthProvider(_ref) {\n  _s();\n\n  var _ref5;\n\n  var children = _ref.children;\n\n  var _useState = useState(null),\n      user = _useState[0],\n      setUser = _useState[1];\n\n  var _useState2 = useState(true),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(true),\n      toggler = _useState3[0],\n      settoggler = _useState3[1];\n\n  useEffect(function () {\n    function loadUserFromCookies() {\n      return _loadUserFromCookies.apply(this, arguments);\n    }\n\n    function _loadUserFromCookies() {\n      _loadUserFromCookies = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var data, token;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                data = false;\n                token = Cookies.get(\"token\");\n\n                if (!token) {\n                  _context.next = 8;\n                  break;\n                }\n\n                console.log(\"Got a token in the cookies, let's see if it is valid\");\n                api.defaults.headers.Authorization = \"Bearer \".concat(token);\n                _context.next = 7;\n                return api.post(\"jwt-auth/v1/token/validate\").then(function (res) {\n                  data = res;\n                })[\"catch\"](function (err) {\n                  Cookies.remove(\"token\");\n                  Cookies.remove(\"user_nicename\");\n                  Cookies.remove(\"user_email\");\n                  Cookies.remove(\"UserType\");\n                  Cookies.remove(\"BracnhCode\");\n                  Cookies.remove(\"CompanyCode\");\n                  Cookies.remove(\"profile_pic\");\n                  Cookies.remove(\"first_name\");\n                  Cookies.remove(\"last_name\");\n                  api.defaults.headers.Authorization = \"\";\n                  Router.push(\"/Management\");\n                });\n\n              case 7:\n                //  const { data: data } = await api.post(\"jwt-auth/v1/token/validate\");\n                if (data) {\n                  console.log(\"old token is valid\");\n                  setUser({\n                    user_nicename: Cookies.get(\"user_nicename\"),\n                    user_email: Cookies.get(\"user_email\"),\n                    UserType: Cookies.get(\"UserType\"),\n                    CompanyCode: Cookies.get(\"CompanyCode\"),\n                    BracnhCode: Cookies.get(\"BracnhCode\"),\n                    profile_pic: Cookies.get(\"profile_pic\"),\n                    first_name: Cookies.get(\"first_name\"),\n                    last_name: Cookies.get(\"last_name\")\n                  });\n                } else {}\n\n              case 8:\n                setLoading(false);\n\n              case 9:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _loadUserFromCookies.apply(this, arguments);\n    }\n\n    loadUserFromCookies();\n  }, []);\n\n  var Sendcond = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(phone) {\n      var tempres;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return api.get(\"rabwa/getUserCode?phone=\" + phone, {});\n\n            case 2:\n              tempres = _context2.sent;\n              return _context2.abrupt(\"return\", tempres);\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function Sendcond(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var phoneLogin = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(phone, code) {\n      var _yield$api$get, data;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return api.get(\"rabwa/singUserIN?phone=\" + phone + \"&code=\" + code, {});\n\n            case 2:\n              _yield$api$get = _context3.sent;\n              data = _yield$api$get.data;\n\n              if (!data) {\n                _context3.next = 23;\n                break;\n              }\n\n              console.log(data);\n              console.log(\"Got new token\" + data.token);\n              Cookies.set(\"token\", data.token, {\n                expires: 60\n              });\n              Cookies.set(\"user_nicename\", data.user_nicename, {\n                expires: 60\n              });\n              Cookies.set(\"user_email\", data.user_email, {\n                expires: 60\n              });\n              Cookies.set(\"UserType\", data.UserType, {\n                expires: 60\n              });\n              Cookies.set(\"BracnhCode\", data.BracnhCode, {\n                expires: 60\n              });\n              Cookies.set(\"CompanyCode\", data.CompanyCode, {\n                expires: 60\n              });\n              Cookies.set(\"profile_pic\", data.profile_pic, {\n                expires: 60\n              });\n              Cookies.set(\"first_name\", data.first_name, {\n                expires: 60\n              });\n              Cookies.set(\"last_name\", data.last_name, {\n                expires: 60\n              });\n              api.defaults.headers.Authorization = \"Bearer \".concat(data.token);\n              setUser({\n                user_nicename: data.user_nicename,\n                user_email: data.user_email,\n                UserType: data.UserType,\n                CompanyCode: data.CompanyCode,\n                BracnhCode: data.BracnhCode,\n                profile_pic: data.profile_pic,\n                first_name: data.first_name,\n                last_name: data.last_name\n              });\n              console.log(\"Got user\", user);\n\n              if (data.UserType == \"Company\") {\n                Router.push(\"/CompanyStatistics\"); //return \"Company\";\n              } else if (data.UserType == \"mandobe\") {\n                // return \"Company\";\n                Router.push(\"/MyUsers\");\n              }\n\n              return _context3.abrupt(\"return\", true);\n\n            case 23:\n              return _context3.abrupt(\"return\", false);\n\n            case 24:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function phoneLogin(_x2, _x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var login = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(username, password) {\n      var _yield$api$post, data;\n\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return api.post(\"jwt-auth/v1/token\", {\n                username: username,\n                password: password\n              });\n\n            case 2:\n              _yield$api$post = _context4.sent;\n              data = _yield$api$post.data;\n\n              if (!data) {\n                _context4.next = 22;\n                break;\n              }\n\n              console.log(data);\n              console.log(\"Got new token\" + data.token);\n              Cookies.set(\"token\", data.token, {\n                expires: 60\n              });\n              Cookies.set(\"user_nicename\", data.user_nicename, {\n                expires: 60\n              });\n              Cookies.set(\"user_email\", data.user_email, {\n                expires: 60\n              });\n              Cookies.set(\"UserType\", data.UserType, {\n                expires: 60\n              });\n              Cookies.set(\"BracnhCode\", data.BracnhCode, {\n                expires: 60\n              });\n              Cookies.set(\"CompanyCode\", data.CompanyCode, {\n                expires: 60\n              });\n              Cookies.set(\"profile_pic\", data.profile_pic, {\n                expires: 60\n              });\n              Cookies.set(\"first_name\", data.first_name, {\n                expires: 60\n              });\n              Cookies.set(\"last_name\", data.last_name, {\n                expires: 60\n              });\n              api.defaults.headers.Authorization = \"Bearer \".concat(data.token);\n              setUser({\n                user_nicename: data.user_nicename,\n                user_email: data.user_email,\n                UserType: data.UserType,\n                CompanyCode: data.CompanyCode,\n                BracnhCode: data.BracnhCode,\n                profile_pic: data.profile_pic,\n                first_name: data.first_name,\n                last_name: data.last_name\n              });\n              console.log(\"Got user\", user);\n              return _context4.abrupt(\"return\", true);\n\n            case 22:\n              return _context4.abrupt(\"return\", false);\n\n            case 23:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function login(_x4, _x5) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var logout = function logout() {\n    Cookies.remove(\"token\");\n    Cookies.remove(\"user_nicename\");\n    Cookies.remove(\"user_email\");\n    Cookies.remove(\"UserType\");\n    Cookies.remove(\"BracnhCode\");\n    Cookies.remove(\"CompanyCode\");\n    Cookies.remove(\"profile_pic\");\n    Cookies.remove(\"first_name\");\n    Cookies.remove(\"last_name\");\n    api.defaults.headers.Authorization = \"\";\n    setUser(null);\n  };\n\n  return __jsx(AuthContext.Provider, {\n    value: (_ref5 = {\n      isAuthenticated: !!user,\n      user: user,\n      login: login,\n      logout: logout,\n      Sendcond: Sendcond,\n      phoneLogin: phoneLogin,\n      loading: loading\n    }, _defineProperty(_ref5, \"logout\", logout), _defineProperty(_ref5, \"toggler\", toggler), _defineProperty(_ref5, \"settoggler\", settoggler), _ref5),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 5\n    }\n  }, children);\n};\n\n_s(AuthProvider, \"kVVI/eaSJW7CjE7sYKzveREop3g=\");\n\n_c = AuthProvider;\nexport default function useAuth() {\n  _s2();\n\n  var context = useContext(AuthContext);\n  return context;\n}\n\n_s2(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\n\nexport function ProtectRoute(Component) {\n  var _arguments = arguments,\n      _this2 = this,\n      _s3 = $RefreshSig$();\n\n  return _s3(function () {\n    _s3();\n\n    var _useAuth = useAuth(),\n        user = _useAuth.user,\n        isAuthenticated = _useAuth.isAuthenticated,\n        loading = _useAuth.loading;\n\n    var router = useRouter();\n    useEffect(function () {\n      if (!isAuthenticated && !loading) {\n        Router.push(\"/Management\");\n      } else if (isAuthenticated) {\n        if (user.UserType != \"admin\") Router.push(\"/\");\n      }\n    }, [loading, isAuthenticated]);\n    return __jsx(Component, _extends({}, _arguments, {\n      __self: _this2,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 12\n      }\n    }));\n  }, \"z/hYDHPFkjbm8+F3Ep7Ukz2trYc=\", false, function () {\n    return [useAuth, useRouter];\n  });\n}\n_c2 = ProtectRoute;\nexport function ProtectRouteCompany(Component) {\n  var _arguments2 = arguments,\n      _this3 = this,\n      _s4 = $RefreshSig$();\n\n  return _s4(function () {\n    _s4();\n\n    var _useAuth2 = useAuth(),\n        user = _useAuth2.user,\n        isAuthenticated = _useAuth2.isAuthenticated,\n        loading = _useAuth2.loading;\n\n    var router = useRouter();\n    useEffect(function () {\n      if (!isAuthenticated && !loading) {\n        Router.push(\"/login\");\n      } else if (isAuthenticated) {\n        if (user.UserType != \"Company\") Router.push(\"/\");\n      }\n    }, [loading, isAuthenticated]);\n    return __jsx(Component, _extends({}, _arguments2, {\n      __self: _this3,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 12\n      }\n    }));\n  }, \"z/hYDHPFkjbm8+F3Ep7Ukz2trYc=\", false, function () {\n    return [useAuth, useRouter];\n  });\n}\n_c3 = ProtectRouteCompany;\nexport function ProtectRouteMandobe(Component) {\n  var _arguments3 = arguments,\n      _this4 = this,\n      _s5 = $RefreshSig$();\n\n  return _s5(function () {\n    _s5();\n\n    var _useAuth3 = useAuth(),\n        user = _useAuth3.user,\n        isAuthenticated = _useAuth3.isAuthenticated,\n        loading = _useAuth3.loading;\n\n    var router = useRouter();\n    useEffect(function () {\n      if (!isAuthenticated && !loading) {\n        Router.push(\"/login\");\n      } else if (isAuthenticated) {\n        if (user.UserType != \"mandobe\") Router.push(\"/\");\n      }\n    }, [loading, isAuthenticated]);\n    return __jsx(Component, _extends({}, _arguments3, {\n      __self: _this4,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 12\n      }\n    }));\n  }, \"z/hYDHPFkjbm8+F3Ep7Ukz2trYc=\", false, function () {\n    return [useAuth, useRouter];\n  });\n}\n_c4 = ProtectRouteMandobe;\n\nvar _c, _c2, _c3, _c4;\n\n$RefreshReg$(_c, \"AuthProvider\");\n$RefreshReg$(_c2, \"ProtectRoute\");\n$RefreshReg$(_c3, \"ProtectRouteCompany\");\n$RefreshReg$(_c4, \"ProtectRouteMandobe\");","map":{"version":3,"sources":["C:/xampp/htdocs/next/contexts/auth.js"],"names":["React","createContext","useState","useContext","useEffect","Cookies","Router","useRouter","api","AuthContext","AuthProvider","children","user","setUser","loading","setLoading","toggler","settoggler","loadUserFromCookies","data","token","get","console","log","defaults","headers","Authorization","post","then","res","err","remove","push","user_nicename","user_email","UserType","CompanyCode","BracnhCode","profile_pic","first_name","last_name","Sendcond","phone","tempres","phoneLogin","code","set","expires","login","username","password","logout","isAuthenticated","useAuth","context","ProtectRoute","Component","router","arguments","ProtectRouteCompany","ProtectRouteMandobe"],"mappings":"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","sourcesContent":["import React, { createContext, useState, useContext, useEffect } from \"react\";\r\nimport Cookies from \"js-cookie\";\r\nimport Router, { useRouter } from \"next/router\";\r\n\r\n//api here is an axios instance\r\nimport api from \"../services/Api\";\r\n\r\nconst AuthContext = createContext({});\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [toggler, settoggler] = useState(true);\r\n\r\n  useEffect(() => {\r\n    async function loadUserFromCookies() {\r\n      let data = false;\r\n      const token = Cookies.get(\"token\");\r\n      if (token) {\r\n        console.log(\"Got a token in the cookies, let's see if it is valid\");\r\n        api.defaults.headers.Authorization = `Bearer ${token}`;\r\n        await api\r\n          .post(\"jwt-auth/v1/token/validate\")\r\n          .then((res) => {\r\n            data = res;\r\n          })\r\n          .catch((err) => {\r\n            Cookies.remove(\"token\");\r\n            Cookies.remove(\"user_nicename\");\r\n            Cookies.remove(\"user_email\");\r\n            Cookies.remove(\"UserType\");\r\n            Cookies.remove(\"BracnhCode\");\r\n            Cookies.remove(\"CompanyCode\");\r\n            Cookies.remove(\"profile_pic\");\r\n            Cookies.remove(\"first_name\");\r\n            Cookies.remove(\"last_name\");\r\n\r\n            api.defaults.headers.Authorization = ``;\r\n\r\n            Router.push(\"/Management\");\r\n          });\r\n        //  const { data: data } = await api.post(\"jwt-auth/v1/token/validate\");\r\n        if (data) {\r\n          console.log(\"old token is valid\");\r\n          setUser({\r\n            user_nicename: Cookies.get(\"user_nicename\"),\r\n            user_email: Cookies.get(\"user_email\"),\r\n            UserType: Cookies.get(\"UserType\"),\r\n            CompanyCode: Cookies.get(\"CompanyCode\"),\r\n            BracnhCode: Cookies.get(\"BracnhCode\"),\r\n            profile_pic: Cookies.get(\"profile_pic\"),\r\n            first_name: Cookies.get(\"first_name\"),\r\n            last_name: Cookies.get(\"last_name\"),\r\n          });\r\n        } else {\r\n        }\r\n      }\r\n      setLoading(false);\r\n    }\r\n    loadUserFromCookies();\r\n  }, []);\r\n\r\n  const Sendcond = async (phone) => {\r\n    let tempres = await api.get(\"rabwa/getUserCode?phone=\" + phone, {});\r\n\r\n    return tempres;\r\n  };\r\n\r\n  const phoneLogin = async (phone, code) => {\r\n    const { data: data } = await api.get(\r\n      \"rabwa/singUserIN?phone=\" + phone + \"&code=\" + code,\r\n      {}\r\n    );\r\n\r\n    if (data) {\r\n      console.log(data);\r\n\r\n      console.log(\"Got new token\" + data.token);\r\n      Cookies.set(\"token\", data.token, { expires: 60 });\r\n      Cookies.set(\"user_nicename\", data.user_nicename, { expires: 60 });\r\n      Cookies.set(\"user_email\", data.user_email, { expires: 60 });\r\n      Cookies.set(\"UserType\", data.UserType, { expires: 60 });\r\n      Cookies.set(\"BracnhCode\", data.BracnhCode, { expires: 60 });\r\n      Cookies.set(\"CompanyCode\", data.CompanyCode, { expires: 60 });\r\n      Cookies.set(\"profile_pic\", data.profile_pic, { expires: 60 });\r\n      Cookies.set(\"first_name\", data.first_name, { expires: 60 });\r\n      Cookies.set(\"last_name\", data.last_name, { expires: 60 });\r\n\r\n      api.defaults.headers.Authorization = `Bearer ${data.token}`;\r\n\r\n      setUser({\r\n        user_nicename: data.user_nicename,\r\n        user_email: data.user_email,\r\n        UserType: data.UserType,\r\n        CompanyCode: data.CompanyCode,\r\n        BracnhCode: data.BracnhCode,\r\n        profile_pic: data.profile_pic,\r\n        first_name: data.first_name,\r\n        last_name: data.last_name,\r\n      });\r\n      console.log(\"Got user\", user);\r\n      if (data.UserType == \"Company\") {\r\n        Router.push(\"/CompanyStatistics\");\r\n        //return \"Company\";\r\n      } else if (data.UserType == \"mandobe\") {\r\n        // return \"Company\";\r\n        Router.push(\"/MyUsers\");\r\n      }\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const login = async (username, password) => {\r\n    const { data: data } = await api.post(\"jwt-auth/v1/token\", {\r\n      username,\r\n      password,\r\n    });\r\n    if (data) {\r\n      console.log(data);\r\n\r\n      console.log(\"Got new token\" + data.token);\r\n      Cookies.set(\"token\", data.token, { expires: 60 });\r\n      Cookies.set(\"user_nicename\", data.user_nicename, { expires: 60 });\r\n      Cookies.set(\"user_email\", data.user_email, { expires: 60 });\r\n      Cookies.set(\"UserType\", data.UserType, { expires: 60 });\r\n      Cookies.set(\"BracnhCode\", data.BracnhCode, { expires: 60 });\r\n      Cookies.set(\"CompanyCode\", data.CompanyCode, { expires: 60 });\r\n      Cookies.set(\"profile_pic\", data.profile_pic, { expires: 60 });\r\n      Cookies.set(\"first_name\", data.first_name, { expires: 60 });\r\n      Cookies.set(\"last_name\", data.last_name, { expires: 60 });\r\n\r\n      api.defaults.headers.Authorization = `Bearer ${data.token}`;\r\n\r\n      setUser({\r\n        user_nicename: data.user_nicename,\r\n        user_email: data.user_email,\r\n        UserType: data.UserType,\r\n        CompanyCode: data.CompanyCode,\r\n        BracnhCode: data.BracnhCode,\r\n        profile_pic: data.profile_pic,\r\n        first_name: data.first_name,\r\n        last_name: data.last_name,\r\n      });\r\n      console.log(\"Got user\", user);\r\n\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    Cookies.remove(\"token\");\r\n    Cookies.remove(\"user_nicename\");\r\n    Cookies.remove(\"user_email\");\r\n    Cookies.remove(\"UserType\");\r\n    Cookies.remove(\"BracnhCode\");\r\n    Cookies.remove(\"CompanyCode\");\r\n    Cookies.remove(\"profile_pic\");\r\n    Cookies.remove(\"first_name\");\r\n    Cookies.remove(\"last_name\");\r\n\r\n    api.defaults.headers.Authorization = ``;\r\n\r\n    setUser(null);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value={{\r\n        isAuthenticated: !!user,\r\n        user,\r\n        login,\r\n        logout,\r\n        Sendcond,\r\n        phoneLogin,\r\n        loading,\r\n        logout,\r\n        toggler,\r\n        settoggler,\r\n      }}\r\n    >\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport default function useAuth() {\r\n  const context = useContext(AuthContext);\r\n\r\n  return context;\r\n}\r\n\r\nexport function ProtectRoute(Component) {\r\n  return () => {\r\n    const { user, isAuthenticated, loading } = useAuth();\r\n    const router = useRouter();\r\n\r\n    useEffect(() => {\r\n      if (!isAuthenticated && !loading) {\r\n        Router.push(\"/Management\");\r\n      } else if (isAuthenticated) {\r\n        if (user.UserType != \"admin\") Router.push(\"/\");\r\n      }\r\n    }, [loading, isAuthenticated]);\r\n\r\n    return <Component {...arguments} />;\r\n  };\r\n}\r\n\r\nexport function ProtectRouteCompany(Component) {\r\n  return () => {\r\n    const { user, isAuthenticated, loading } = useAuth();\r\n    const router = useRouter();\r\n\r\n    useEffect(() => {\r\n      if (!isAuthenticated && !loading) {\r\n        Router.push(\"/login\");\r\n      } else if (isAuthenticated) {\r\n        if (user.UserType != \"Company\") Router.push(\"/\");\r\n      }\r\n    }, [loading, isAuthenticated]);\r\n\r\n    return <Component {...arguments} />;\r\n  };\r\n}\r\n\r\nexport function ProtectRouteMandobe(Component) {\r\n  return () => {\r\n    const { user, isAuthenticated, loading } = useAuth();\r\n    const router = useRouter();\r\n\r\n    useEffect(() => {\r\n      if (!isAuthenticated && !loading) {\r\n        Router.push(\"/login\");\r\n      } else if (isAuthenticated) {\r\n        if (user.UserType != \"mandobe\") Router.push(\"/\");\r\n      }\r\n    }, [loading, isAuthenticated]);\r\n\r\n    return <Component {...arguments} />;\r\n  };\r\n}\r\n"]},"metadata":{},"sourceType":"module"}